kind: pipeline
type: kubernetes
name: default



platform:
  os: linux
  arch: arm64

clone:
  disable: true
  

steps:
- name: clone
  image: bitnami/git
  commands:
  - sleep 2
  - git clone https://github.com/yuexclusive/foo.git
  # - git checkout $DRONE_COMMIT

# - name: build
#   image: golang:1.18beta1-alpine3.15
#   commands:
#   - apk update 
#   - apk add git
#   - cd foo
#   - go version
#   - go build -o test .

- name: publish
  image: docker:dind
  volumes:
  - name: dockersock
    path: /var/run
  commands:
  - sleep 100000000
  - cd foo
  - docker build --rm -t yuexclusive/test:latest .
  - docker publish yuexclusive/test:latest
  
services:
- name: docker
  image: docker:dind
  privileged: true
  volumes:
  - name: dockersock
    path: /var/run

volumes:
- name: dockersock
  temp: {}